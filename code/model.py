#!/usr/bin/env python
# -*- encoding: utf-8 -*-
'''
@File    :   features.py
@Contact :   3289218653@qq.com
@License :   (C)Copyright 2021-2022 PowerLZY

@Modify Time      @Author           @Version    @Desciption
------------      -------           --------    -----------
2021-10-04 17:17   PowerLZY&yuan_mes  1.0       自定义模型
'''

import joblib
import numpy as np
from sklearn.model_selection import StratifiedKFold, cross_val_score


class Model(object):
    """ Model training, cross-validation and predicting. """

    def __init__(self, model=None, X=None, y=None, label=None, inter_path=None, result_path=None):
        self.model = model
        self.X = X
        self.y = y
        self.label = label
        self.inter_path = inter_path
        self.result_path = result_path

    def CrossValidation(self, n_splits):
        cv = StratifiedKFold(n_splits=n_splits)
        cv_scores = cross_val_score(self.model, self.X, self.y, scoring='neg_log_loss', cv=cv)
        print(f"Logloss_mean after {n_splits} folds: {-np.mean(cv_scores):.6f}")

    def get_class_weight(self):
        # TODO: get_class_weight
        pass

    def Fit(self):
        self.model.fit(self.X, self.y)
        joblib.dump(self.model, f"{self.inter_path}/model_{self.label}.pkl")

    def Predict(self, test_X):
        model = joblib.load(f"{self.inter_path}/model_{self.label}.pkl")
        test_y = model.predict_proba(test_X)
        np.save(f"{self.result_path}/submit_{self.label}.npy", test_y)
        return test_y
